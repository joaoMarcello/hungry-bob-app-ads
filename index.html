<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Hungry Bob</title>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet"/>
  <style>
    body {
      margin: 0;
      background-color: #111;
      color: #fff;
      font-family: 'Press Start 2P', monospace;
      line-height: 1.6;
    }
    header {
      background: #222;
      text-align: center;
      padding: 1rem 1rem 0.5rem;
    }
    header h1 {
      font-size: 2rem;
      color: #00ffe1;
      margin: 0;
      padding-bottom: 0.5rem;
    }
    .banner {
      max-width: 960px;
      margin: 0.5rem auto 2rem;
      border: 4px solid #00ffe1;
      box-shadow: 0 0 12px #00ffe1aa;
    }
    .container {
      max-width: 960px;
      margin: 0 auto 2rem;
      padding: 0 1rem;
    }
    .section {
      margin-bottom: 3rem;
    }
    h2 {
      font-size: 1.5rem;
      color: #ffdf00;
      margin-bottom: 1rem;
    }
    img.placeholder {
      width: 100%;
      max-width: 600px;
      display: block;
      margin: 1rem auto;
      border: 4px solid #555;
    }
    ul {
      list-style: none;
      padding: 0;
    }
    ul li {
      background: #222;
      margin-bottom: 0.75rem;
      padding: 1rem;
      border-left: 5px solid #00ffe1;
    }
    footer {
      text-align: center;
      padding: 1rem;
      font-size: 0.8rem;
      color: #888;
    }
    table.leaderboard {
      width: 100%;
      border-collapse: collapse;
      background: #222;
      margin-top: 1rem;
    }
    table.leaderboard th {
      background: #333;
      color: #00ffe1;
      padding: 0.75rem;
      text-align: left;
      border-bottom: 2px solid #00ffe1;
      font-size: 0.9rem;
    }
    table.leaderboard td {
      padding: 0.75rem;
      border-bottom: 1px solid #333;
      font-size: 0.8rem;
    }
    table.leaderboard tr:hover {
      background: #2a2a2a;
    }
    table.leaderboard .rank {
      color: #ffdf00;
      font-weight: bold;
      width: 50px;
    }
    table.leaderboard .name {
      color: #fff;
    }
    table.leaderboard .score {
      color: #00ff88;
      text-align: right;
    }
    table.leaderboard .time {
      color: #ff8800;
      text-align: right;
    }
    .refresh-btn {
      background: #00ffe1;
      color: #111;
      border: none;
      padding: 0.75rem 1.5rem;
      font-family: 'Press Start 2P', monospace;
      font-size: 0.7rem;
      cursor: pointer;
      margin-bottom: 1rem;
      transition: all 0.2s;
      box-shadow: 0 4px 0 #00bba8;
    }
    .refresh-btn:hover {
      background: #00ffff;
      transform: translateY(-2px);
      box-shadow: 0 6px 0 #00bba8;
    }
    .refresh-btn:active {
      transform: translateY(2px);
      box-shadow: 0 2px 0 #00bba8;
    }
    @media (max-width: 600px) {
      header h1 {
        font-size: 1.2rem;
      }
      h2 {
        font-size: 1rem;
      }
      ul li {
        font-size: 0.75rem;
      }
      table.leaderboard th,
      table.leaderboard td {
        font-size: 0.65rem;
        padding: 0.5rem;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>Hungry Bob</h1>
    <img class="banner" src="https://placehold.co/960x200?text=Hungry+Bob+Banner" alt="Hungry Bob Banner" />
  </header>

  <main class="container">
    <section class="section">
      <h2>About the Game</h2>
      <p>A cat. Lots of fish. And no time to rest.</p>
      <p>In <strong>Hungry Bob</strong>, you control a hungry ‚Äî and slightly temperamental ‚Äî cat in a never-ending fish frenzy. This is a <strong>fast-paced 2D arcade platformer</strong> where fish fall from the sky and your mission is simple (yet desperate): catch only <em>the fish Bob wants at that moment</em>. Grab the wrong one, or miss it, and you're in trouble.</p>
      <p>And it gets worse: <strong>pufferfish</strong> fall too. Bob can't touch them, can't hit them ‚Äî just avoid them at all costs. One wrong move and it's game over.</p>
      <p>With charming <strong>retro pixel art</strong> and a genuine <strong>CRT filter</strong>, <em>Hungry Bob</em> brings back the spirit of '90s arcades in <strong>quick, addictive rounds</strong> perfect for mobile gaming.</p>
      <p>The speed increases, Bob's tastes change constantly, and only the sharpest players will reach the top of the <strong>global leaderboard</strong>. Got a gamepad nearby? Bob's cool with that too.</p>
      <img class="placeholder" src="https://placehold.co/600x400?text=Screenshot+1" alt="Screenshot 1" />
    </section>

    <section class="section">
      <h2>Highlights</h2>
      <ul>
        <li>üê± Retro arcade action with reflex and precision</li>
        <li>üì∫ Pixel art + CRT filter for true nostalgia</li>
        <li>üê° Dodge the pufferfish ‚Äî they‚Äôre not your friends!</li>
        <li>‚è±Ô∏è Quick rounds, perfect for mobile play</li>
        <li>üèÜ Online leaderboard for competitive players</li>
        <li>üöπ Gamepad support included</li>
        <li>üîÅ Changing fish preference: total focus required</li>
        <li>üòº Casual and hardcore difficulty modes</li>
      </ul>
      <img class="placeholder" src="https://placehold.co/600x400?text=Screenshot+2" alt="Screenshot 2" />
    </section>

    <section class="section">
      <h2>Global Leaderboard</h2>
      <button class="refresh-btn" onclick="loadLeaderboard()">üîÑ Refresh</button>
      <div id="leaderboard-container">
        <p style="text-align: center;">Loading leaderboard...</p>
      </div>
    </section>
  </main>

  <footer>
    ¬© 2025 Hungry Bob. All rights reserved.
  </footer>

  <script>
    // LootLocker configuration
    const GAME_KEY = 'dev_4363a26d4b784364946a56dc632054c0';
    const LEADERBOARD_ID = '21459';
    const MAX_ENTRIES = 10;
    
    let sessionToken = null;
    
    // Authenticate with LootLocker
    async function authenticate() {
      try {
        const response = await fetch('https://api.lootlocker.io/game/v2/session/guest', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            game_key: GAME_KEY,
            game_version: '1.0.0'
          })
        });
        
        const data = await response.json();
        if (data.session_token) {
          sessionToken = data.session_token;
          return true;
        }
        return false;
      } catch (error) {
        console.error('Authentication error:', error);
        return false;
      }
    }
    
    // Fetch and display leaderboard
    async function loadLeaderboard() {
      const container = document.getElementById('leaderboard-container');
      container.innerHTML = '<p style="text-align: center;">Loading leaderboard...</p>';
      
      try {
        // Authenticate if needed
        if (!sessionToken) {
          const authenticated = await authenticate();
          if (!authenticated) {
            throw new Error('Authentication failed');
          }
        }
        
        // Fetch leaderboard
        const response = await fetch(
          `https://api.lootlocker.io/game/leaderboards/${LEADERBOARD_ID}/list?count=${MAX_ENTRIES}`,
          {
            headers: {
              'x-session-token': sessionToken
            }
          }
        );
        
        const data = await response.json();
        
        if (!data.items || data.items.length === 0) {
          container.innerHTML = '<p style="text-align: center;">No entries yet.</p>';
          return;
        }
        
        // Format time as MM:SS
        function formatTime(seconds) {
          const totalSecs = Math.floor(parseFloat(seconds));
          const mins = Math.floor(totalSecs / 60);
          const secs = totalSecs % 60;
          return mins + ':' + (secs < 10 ? '0' : '') + secs;
        }
        
        // Build table
        let html = '<table class="leaderboard">';
        html += '<thead><tr><th class="rank">#</th><th class="name">Player</th><th class="score">Score</th><th class="time">Time</th></tr></thead>';
        html += '<tbody>';
        
        data.items.forEach((entry) => {
          // Parse metadata
          let timeFormatted = '-';
          if (entry.metadata) {
            try {
              // Replace single quotes with double quotes for valid JSON
              const fixedMetadata = entry.metadata.replace(/'/g, '"');
              const metadata = JSON.parse(fixedMetadata);
              if (metadata.seconds) {
                timeFormatted = formatTime(metadata.seconds);
              }
            } catch (e) {
              console.error('Error parsing metadata:', e, entry.metadata);
            }
          }
          
          html += '<tr>';
          html += '<td class="rank">' + entry.rank + '</td>';
          html += '<td class="name">' + (entry.member_id || entry.player?.name || 'Anonymous') + '</td>';
          html += '<td class="score">' + entry.score.toLocaleString() + '</td>';
          html += '<td class="time">' + timeFormatted + '</td>';
          html += '</tr>';
        });
        
        html += '</tbody></table>';
        container.innerHTML = html;
        
      } catch (error) {
        container.innerHTML = '<p style="text-align: center; color: #ff4444;">Failed to load leaderboard. Please try again later.</p>';
        console.error('Error loading leaderboard:', error);
      }
    }
    
    // Load on page load
    loadLeaderboard();
  </script>
</body>
</html>
